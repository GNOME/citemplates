include:
  # used in the pipeline
  - local: "templates/basic-release.yml"

  # Testing the local templates
  - local: "test-the-templates/flatpak.yml"
    rules:
      - changes:
          paths:
            - "flatpak/*"
            - "templates/defeault-rules.yml"
            - "test-the-templates/flatpak.yml"

  - local: "test-the-templates/gnomeos-basic-ci.yml"
    rules:
      - changes:
          paths:
            - "templates/gnomeos-basic-ci.yml"
            - "test-the-templates/gnomeos-basic-ci.yml"

  - local: "test-the-templates/test-tarball-dist.yml"
    rules:
      - changes:
          paths:
            - "flatpak/*"
            - "templates/gnomeos-basic-ci.yml"
            - "test-the-templates/test-tarball-dist.yml"

  - local: "test-the-templates/test-docs-generation.yml"
    rules:
      - changes:
          paths:
            - "flatpak/*"
            - "templates/gnomeos-basic-ci.yml"
            - "test-the-templates/test-docs-generation.yml"

  - local: "templates/default-rules.yml"

stages:
  - "Flatpak app"
  - "GNOMEOS Basic CI"
  - "Dist tarball tests"
  - "Docs generation tests"
  - "deploy"

remove-gh-packages:
  needs: []
  image: fedora
  stage: "deploy"
  script:
    - dnf install -y gh
    - export GITHUB_TOKEN=$(cat $NIGHTLY_CACHE_GHCR_TOKEN_FILE)
    - bash gh_delete.sh gnome-infra 'org.gnome'
