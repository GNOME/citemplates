spec:
  inputs:
    job-name:
      default: "markdown lint"
      description: "Name for the job"
    job-stage:
      default: "lint"
      description: "Stage to run the job"
---
"$[[ inputs.job-name ]]":
  stage: $[[ inputs.job-stage ]]
  needs: []
  image: "debian:13"
  before_script:
    - apt update --assume-yes --quiet=1
    - apt install --assume-yes --quiet=1 curl

    # We could make this a component input, but ideally we want
    # to have pinned, pre-built images to avoid apt/curl.
    #
    # Thus its harder to accommodate an image for every version.
    - rumdl_tag="v0.0.194"

    - mkdir -p "$CI_PROJECT_DIR/bin"
    - curl -LsSf "https://github.com/rvben/rumdl/releases/download/$rumdl_tag/rumdl-$rumdl_tag-x86_64-unknown-linux-gnu.tar.gz" | tar xzf - -C "$CI_PROJECT_DIR/bin"
  script:
    - $CI_PROJECT_DIR/bin/rumdl check --output-format gitlab $CI_PROJECT_DIR > "$CI_PROJECT_DIR/rumdl.json"
  after_script:
    - cat "$CI_PROJECT_DIR/rumdl.json"
  rules:
    - changes:
        paths:
          - ".rumdl.toml"
          - "*.md"
          - "**/*.md"
  artifacts:
    when: always
    paths:
      - rumdl.json
    reports:
      codequality: rumdl.json
